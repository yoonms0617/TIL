# 쿠키와 세션

쿠키와 세션은 HTTP가 가지고 있는 특징인 `Connectionless`와 `Stateless`를 보완하기 위해 사용된다.

- **Connectionless(비연결성):** 클라이언트가 요청을 한 후 응답을 받으면 연결을 끊어 버리는 특징
- **Stateless(무상태성):** 통신이 끝나면 상태를 유지하지 않는 특징

## 쿠키(Cookie)

쿠키는 클라이언트(브라우저)에서 관리되는 키와 값이 들어있는 데이터 파일을 의미한다.

- 이름, 값, 만료일(저장 기간 설정), 경로 정보로 구성되어있다.
- 사용자 인증이 유효한 시간을 명시할 수 있으며 유효 시간이 정해지면 브라우저를 종료해도 인증이 유지된다.
- 클라이언트에 총 300개의 쿠키를 저장할 수 있으며 하나의 도메인당 20개의 쿠키를 가질 수 있다.
- 하나의 쿠키는 4KB(4096Byte)까지 저장 할 수 있다.
- 클라이언트가 요청시 헤더에 자동으로 포함되 서버에 전송된다.

#### 쿠키 동작 방식

1. 클라이언트가 페이지를 요청
2. 서버에서 쿠키를 생성하고 헤더에 포함시켜 응답한다. (set-cookie)
3. 쿠키 만료 기간이 설정되어 있다면 브라우저가 종료되어도 클라이언트에서 해당 쿠키를 관리하고 있다.
4. 쿠키가 존재할 경우 헤더에 쿠키를 함께 포함시켜 요청한다. (cookie)
5. 서버에서 해당 쿠키를 읽어 이전 상태 정보를 변경할 필요가 있을 경우 쿠키를 업데이트해 변경된 쿠키를 헤더에 포함시켜 응답한다.

```text
set-cookie  HTTP Response Header에 적절한 값을 담아 서버가 클라이언트에 응답한다.
cookie      HTTP Request Header에 set-cookie에 설정된 값을 포함해 서버로 전송한다.
```

#### 쿠키 사용 예

- 세션 관리 (로그인, 장바구니 등)
- 개인화 (사용자 선호, 테마 등의 세팅)
- 트래킹 (사용자 행동을 기억하고 분석하는 용도)

## 세션(Session)

세션은 쿠키를 기반으로 동작하지만 브라우저에서 관리하는 쿠키와는 다르게 서버에서 관리한다.

> 세션: 사용자가 브라우저를 닫아 연결을 끝내는 시점까지를 세션이라 한다.

쿠키는 쿠키에 설정된 값을 통해 클라이어트의 상태를 기억하게 한다면 세션은 서버가 클라이언트에게 부여한 세션 ID를 통해 기억한다.

- 각 클라이언트에게 고유한 ID를 부여한다.
- 세션 ID로 클라이언트를 구분해 요구에 맞는 서비스를 제공할 수 있다.
- 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 세션이 삭제가 되므로 쿠키에 비해 보안이 좋다.
- 서버에 저장되기 때문에 계속해서 늘어날 경우 서버에 부담을 줄 수 있다.
- 동시 접속자 수가 많은 웹 사이트의 경우 서버에 과부하를 줄 수 있다.
- 서버의 메모리가 허용하는한 저장 데이터에 제한이 없다.

#### 세션 동작 방식

1. 클라이언트가 서버에 요청하면 서버는 클라이언트를 식별하는 세션 ID를 생성해 쿠키를 응답 헤더에 포함해 응답한다. (set-cookie)
2. 새로운 요청을 할 경우 이전에 받은 쿠키 값을 포함하고 있다가 세션 ID값이 담긴 쿠키를 요청 헤더에 포함해 요청한다. (cookie)
3. 서버는 세션 ID를 세션 저장소에서 확인하고 유효한지 확인 후 요청을 처리하고 응답한다.

#### 셰션 사용 예

- 로그인 유지

## 쿠키와 세션 차이

- 세션도 쿠키를 사용하기 때문에 쿠키와 세션은 비슷한 역할을 하며 동작원리도 비슷하다.
- 둘의 큰 차이는 저장위치이며 쿠키는 서버의 자원을 전혀 사용하지 않고 클라이언트에서 관리하지만 세션은 서버의 자원을 사용한다.
- 쿠키는 만료 시간을 정해 브라우저가 종료되어도 만료 시간이 되지 않는한 쿠키 정보가 삭제되지 않고 남아 있을 수 있다. 단, 쿠키의 만료 시간을 설정하지 않을 경우 브라우저가 종료되면 삭제되는데 이를 세션쿠키라고 한다.
- 세션의 경우 만료 시간을 설정할 수 있지만 브라우저가 종료되는 순간 만료 시간에 상관없이 삭제된다.
- 쿠키는 클라이언트에 정보가 있기 때문에 서버에 요청이 함께 포함되어 속도가 빠르다. 세션은 실제 저장된 정보가 서버에 있기 때문에 서버의 처리가 필요해 쿠키에 비해 속도가 느리다.
- 쿠키는 클라이언트에 텍스트 형태로 저장되다 보니 악의적인 공격에 의해 변조될 가능성이 크다. 쿠키에 비해서 안전하다 세션 ID는 클라이언트에서 관리되지만 정보 자체는 서버에서 관리되기 때문이다.

---

#### 참고

- <https://hahahoho5915.tistory.com/32>
- <https://interconnection.tistory.com/74>
